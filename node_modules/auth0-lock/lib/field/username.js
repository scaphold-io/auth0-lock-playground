'use strict';

exports.__esModule = true;
exports.setUsername = setUsername;
exports.usernameLooksLikeEmail = usernameLooksLikeEmail;

var _index = require('./index');

var _email = require('./email');

var _trim = require('trim');

var _trim2 = _interopRequireDefault(_trim);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var regExp = /^[a-zA-Z0-9_]{1,15}$/;

function validateUsername(str, validateFormat) {
  if (!validateFormat) return (0, _trim2.default)(str).length > 0;

  var result = regExp.exec((0, _trim2.default)(str.toLowerCase()));
  return result && result[0];
}

function setUsername(m, str) {
  var usernameStyle = arguments.length <= 2 || arguments[2] === undefined ? "username" : arguments[2];
  var validateUsernameFormat = arguments.length <= 3 || arguments[3] === undefined ? true : arguments[3];


  var validator = function validator(value) {
    switch (usernameStyle) {
      case "email":
        return (0, _email.validateEmail)(value);
      case "username":
        return validateUsername(value, validateUsernameFormat);
      default:
        return usernameLooksLikeEmail(value) ? (0, _email.validateEmail)(value) : validateUsername(value, validateUsernameFormat);
    }
  };

  return (0, _index.setField)(m, "username", str, validator);
}

function usernameLooksLikeEmail(str) {
  return str.indexOf("@") > -1;
}
